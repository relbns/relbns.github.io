---
const { title } = Astro.props;
// מזהה ייחודי כדי לתמוך בכמה דוגמאות באותו עמוד
const id = `ex-${Math.random().toString(36).slice(2, 8)}`;
---

<div class="example-box" id={id}>
  {title && <h3 class="example-title">{title}</h3>}

  <div class="example-preview">
    <div class="slot-root">
      <slot />
    </div>
  </div>

  <div class="example-code">
    <pre><code id={`${id}-code`}></code></pre>
    <button class="copy-btn" data-target={`${id}-code`}>📋 העתק</button>
  </div>
</div>

<script>
  (function () {
    const ROOT_ID = "{id}";
    const root = document.getElementById(ROOT_ID);
    if (!root) return;

    const codeEl = root.querySelector('code');
    const src = root.querySelector('.slot-root');
    if (codeEl && src) {
      // לוקחים את ה-HTML שנרונדר בתוך הדוגמה
      let html = src.innerHTML.trim();

      // ניקוי קטן כדי שיהיה נעים לעין (אפשר להחליף בפורמטור רציני אם תרצה)
      html = html.replace(/\s+<\/(div|style)>/g, '</$1>');

      codeEl.textContent = html;
    }

    const btn = root.querySelector('.copy-btn');
    if (btn && codeEl) {
      btn.addEventListener('click', () => {
        navigator.clipboard.writeText(codeEl.textContent || '');
        const old = btn.textContent;
        btn.textContent = '✔ הועתק';
        setTimeout(() => (btn.textContent = old), 1200);
      });
    }
  })();
</script>

<style>
.example-box {
  border: 1px solid var(--border, #ddd);
  border-radius: 10px;
  overflow: hidden;
  margin: 2rem 0;
  background: var(--background, #fafafa);
}
.example-title {
  margin: 0;
  padding: 1rem;
  background: var(--muted, #f3f3f3);
  border-bottom: 1px solid #ddd;
  font-weight: 600;
  direction: rtl;
}
.example-preview {
  padding: 1.5rem;
  background: var(--preview-bg, #fff);
  direction: rtl; /* שמור RTL לטקסט בתוך הדוגמה */
}
.example-code {
  position: relative;
  padding: 1rem;
  background: var(--code-bg, #1e1e1e);
  color: #f8f8f2;
  font-family: 'Fira Code', monospace;
  overflow-x: auto;
}
.copy-btn {
  position: absolute;
  top: 0.5rem;
  left: 0.5rem;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  color: #fff;
  cursor: pointer;
  font-size: 0.8rem;
  padding: 0.3rem 0.6rem;
  border-radius: 4px;
  transition: background 0.2s ease;
}
.copy-btn:hover {
  background: rgba(255, 255, 255, 0.2);
}
</style>
